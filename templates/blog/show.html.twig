{% extends 'base.html.twig' %}

{% block body %}
<div class="my-5 d-flex justify-content-center">
    <div style="max-width: 800px; width: 100%; padding: 0 15px;">


        <div class="mb-4 d-flex justify-content-end">
            <a href="{{ path('blog_create') }}" class="btn btn-success">
                <i class="bi bi-plus-lg"></i>+ Ajouter un article
            </a>
        </div>

        <article class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h2 class="mb-0">{{article.title}}</h2>
                <small>
                    Écrit le {{article.createdAt|date('d/m/Y') }} à {{article.createdAt|date('H:i') }}
                    dans la catégorie <span class="badge bg-secondary">{{ article.category.title }}</span>
                </small>
            </div>
            <div class="card-body">
                {% if article.image %}
                    <img src="{{ article.image }}" alt="{{ article.title }}" class="img-fluid mb-4 rounded mx-auto d-block" style="max-height: 400px; object-fit: cover;">
                {% else %}
                    <div class="text-center mb-4 text-muted">Pas d'image disponible</div>
                {% endif %}

                <p class="fs-5" style="line-height: 1.6;">{{ article.content| raw }}</p>

                <hr>

                <div class="d-flex justify-content-between align-items-center mt-4">
                    <a href="{{ path('blog') }}" class="btn btn-outline-primary">← Retour aux articles</a>

                    <div  style="padding: 1rem 1.25rem;">
                        <!-- Bouton Modifier -->
                        <a href="" class="btn btn-sm btn-primary"> J'aime(0)</a>
                        <a href="" class="btn btn-sm btn-success">Commenter</a>
                         <a href="{{ path('blog_edit', {'id': article.id}) }}" class="btn btn-sm btn-primary">
                            Modifier
                        </a> 

                        <!-- Bouton Supprimer -->
                         <form action="{{ path('blog_delete', {id: article.id}) }}" method="POST" class="d-inline" onsubmit="return confirm('Supprimer cet article ?');">
                            <input type="hidden" name="_token" value="{{ csrf_token('delete-article' ~ article.id) }}">
                            <button class="btn btn-sm btn-danger">Supprimer</button>
                        </form>
                        <a href="" class="btn btn-sm btn-warning">Partager</a>

                    </div>
                </div>
            </div>
        </article>


<section id="Commentaires" class="mt-5">
            <h3>Commentaires ({{ article.comments|length }})</h3>

            {% if article.comments|length == 0 %}
                <p class="text-muted">Aucun commentaire pour cet article pour le moment.</p>
            {% else %}
                {% for comment in article.comments %}
                    <div class="card mb-3 shadow-sm" style="border-radius: 10px; border: 1px solid #ddd;">
                        <div class="card-body" style="padding: 1rem 1.25rem;">
                            <div class="d-flex justify-content-between mb-2">
                                <strong>{{ comment.author }}</strong>
                                
                                 <form action="{{ path('app_comment_delete', {id: comment.id}) }}" method="POST" class="d-inline" onsubmit="return confirm('Voulez-vous vraiment supprimer ce commentaire ?');">
                                     <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ comment.id) }}">
                                     <button class="btn btn-sm btn-danger">Supprimer</button>
                                    </form>
                                <a href="{{ path('app_comment_edit', {'id': comment.id}) }} " class="btn btn-sm btn-primary">Modifier</a>
                                 <a href="" class="btn btn-sm btn-warning">Signaler</a>
                                
                                <small class="text-muted">{{ comment.createdAt|date('d/m/Y à H:i') }}</small>
                            </div>
                            <p class="mb-0" style="white-space: pre-wrap; line-height: 1.5;">{{ comment.content|raw }}</p>
                             <a href="" class="btn btn-sm btn-primary"> <span>J'aime(0)</span></a>
                             <a href=""class="btn btn-sm btn-primary">Répondre</a>
                        </div>
                    </div>
                {% endfor %}
            {% endif %}
            {% if app.user %}
           <h4 class="mt-5">Laisser un commentaire</h4>
                    {{ form_start(formComment, {
                                    
                                'method': 'POST',
                               
                            }
                        )
                    }}
                    <div class="mb-3">
                        {{ form_row(formComment.author, { 'attr': {'class': 'form-control', 'placeholder': 'Votre nom'} }) }}
                    </div>
                    <div class="mb-3">
                        {{ form_row(formComment.content, { 'attr': {'class': 'form-control',  'placeholder': 'Votre commentaire'}  }) }}
                    </div>
                    <div class="text-end">
                    <button  type="submit" class="btn btn-success">
                                <i class="bi bi-plus-circle"></i> Ajouter 
                    </button>
                    </div>

                {{ form_end(formComment) }}
            {% else %}
            <h1>Vous ne pouvez pas commenter si vous n'êtes pas connecté ! </h1>
            
            <a class="btn btn-outline-primary btn-sm" href="{{ path('security_login') }}">Connexion</a>
            {% endif %}
                 
</section>
    </div>
</div>

<script>
    const showBtn = document.getElementById('showCommentFormBtn');
    const form = document.getElementById('commentForm');
    const cancelBtn = document.getElementById('cancelCommentBtn');

    showBtn.addEventListener('click', () => {
        form.style.display = 'block';
        showBtn.style.display = 'none';
    });

    cancelBtn.addEventListener('click', () => {
        form.style.display = 'none';
        showBtn.style.display = 'inline-block';
    });
</script>
{% endblock %}
